# Shameless copy of @AlastairUK's fine work for the jpl_eph repo.
# Extended a bit to include additional libraries.
name: Build

on: [push, pull_request]

jobs:
  buildUbuntu:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: make
      run: |
        git clone https://github.com/Bill-Gray/lunar
        cd lunar
        make liblunar.a
        make install
        cd ..
        git clone https://github.com/Bill-Gray/sat_code
        cd sat_code
        make libsatell.a
        make install_lib
        cd ..
        git clone https://github.com/Bill-Gray/jpl_eph
        cd jpl_eph
        make libjpl.a
        make install
        cd ..
        make fo

  buildOSX:
    runs-on: macOS-latest
    steps:
    - uses: actions/checkout@master
    - name: make
      run: |
        git clone https://github.com/Bill-Gray/lunar
        cd lunar
        make CLANG=Y liblunar.a
        make install
        cd ..
        git clone https://github.com/Bill-Gray/sat_code
        cd sat_code
        make CLANG=Y libsatell.a
        make install_lib
        cd ..
        git clone https://github.com/Bill-Gray/jpl_eph
        cd jpl_eph
        make CLANG=Y libjpl.a
        make install
        cd ..
        make fo

  buildWindows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@master
    - name: make
      run: |
        call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x64
        mkdir myincl
        git clone https://github.com/Bill-Gray/lunar
        cd lunar
        nmake -f lunar.mak lunar64.lib
        copy lunar64.lib ..
        nmake -f lunar.mak install
        cd ..
        git clone https://github.com/Bill-Gray/sat_code
        cd sat_code
        nmake -f msvc.mak sat_code64.lib
        copy sat_code64.lib ..
        nmake -f msvc.mak install
        cd ..
        git clone https://github.com/Bill-Gray/jpl_eph
        cd jpl_eph
        set CL=/I"../myincl"
        nmake -f vc.mak jpleph.lib
        copy jpleph.lib ..\jpleph64.lib
        copy jpleph.h ..\myincl
        cd ..
        set CL=/I"./myincl"
        nmake -f dos_find.mak fo.exe
      shell: cmd
